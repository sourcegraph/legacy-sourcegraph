resources:
  - apiVersion: apps/v1
    kind: Deployment
    metadata:
      annotations:
        appliance.sourcegraph.com/configHash: 7fa2fa4ff84df20d92d920222aede2b1ac9aa4052123d7b4586cd1b7c5137530
      creationTimestamp: "2024-04-19T00:00:00Z"
      generation: 1
      labels:
        app.kubernetes.io/component: redis-cache
        app.kubernetes.io/name: sourcegraph
        app.kubernetes.io/version: 5.3.9104
        deploy: sourcegraph
      name: redis-cache
      namespace: NORMALIZED_FOR_TESTING
      ownerReferences:
        - apiVersion: v1
          blockOwnerDeletion: true
          controller: true
          kind: ConfigMap
          name: sg
          uid: NORMALIZED_FOR_TESTING
      resourceVersion: NORMALIZED_FOR_TESTING
      uid: NORMALIZED_FOR_TESTING
    spec:
      minReadySeconds: 10
      progressDeadlineSeconds: 600
      replicas: 1
      revisionHistoryLimit: 10
      selector:
        matchLabels:
          app: redis-cache
      strategy:
        type: Recreate
      template:
        metadata:
          annotations:
            kubectl.kubernetes.io/default-container: redis-cache
          creationTimestamp: null
          labels:
            app: redis-cache
            deploy: sourcegraph
          name: redis-cache
        spec:
          containers:
            - image: index.docker.io/sourcegraph/redis-custom-image:default
              imagePullPolicy: IfNotPresent
              livenessProbe:
                failureThreshold: 2
                initialDelaySeconds: 60
                periodSeconds: 30
                successThreshold: 1
                tcpSocket:
                  port: redis
                timeoutSeconds: 5
              name: redis-cache
              ports:
                - containerPort: 6379
                  name: redis
                  protocol: TCP
              readinessProbe:
                exec:
                  command:
                    - /bin/sh
                    - -c
                    - |2
                      #!/bin/bash
                      if [ -f /etc/redis/redis.conf ]; then
                        REDISCLI_AUTH=$(grep -h "requirepass" /etc/redis/redis.conf | cut -d ' ' -f 2)
                      fi
                      response=$(
                        redis-cli ping
                      )
                      if [ "$response" != "PONG" ]; then
                        echo "$response"
                        exit 1
                      fi
                failureThreshold: 3
                initialDelaySeconds: 5
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 1
              resources:
                limits:
                  cpu: "1"
                  memory: 7Gi
                requests:
                  cpu: "1"
                  memory: 7Gi
              securityContext:
                allowPrivilegeEscalation: false
                readOnlyRootFilesystem: true
                runAsGroup: 1000
                runAsUser: 999
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: FallbackToLogsOnError
              volumeMounts:
                - mountPath: /redis-data
                  name: redis-data
            - image: index.docker.io/sourcegraph/redis-exporter-custom-image:default
              imagePullPolicy: IfNotPresent
              name: redis-exporter
              ports:
                - containerPort: 9121
                  name: redisexp
                  protocol: TCP
              resources:
                limits:
                  cpu: 10m
                  memory: 100Mi
                requests:
                  cpu: 10m
                  memory: 100Mi
              securityContext:
                allowPrivilegeEscalation: false
                readOnlyRootFilesystem: true
                runAsGroup: 1000
                runAsUser: 999
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: FallbackToLogsOnError
          dnsPolicy: ClusterFirst
          restartPolicy: Always
          schedulerName: default-scheduler
          securityContext:
            fsGroup: 1000
            fsGroupChangePolicy: OnRootMismatch
            runAsGroup: 101
            runAsUser: 100
          terminationGracePeriodSeconds: 30
          volumes:
            - name: redis-data
              persistentVolumeClaim:
                claimName: redis-cache
    status: {}
  - apiVersion: apps/v1
    kind: StatefulSet
    metadata:
      annotations:
        appliance.sourcegraph.com/configHash: c7ada10d28d26c809f8b7e71aabb5a65420c3c2f306a364d3b9b966189d84a05
      creationTimestamp: "2024-04-19T00:00:00Z"
      generation: 1
      labels:
        app.kubernetes.io/component: grafana
        app.kubernetes.io/name: sourcegraph
        app.kubernetes.io/version: 5.3.9104
        deploy: sourcegraph
      name: grafana
      namespace: NORMALIZED_FOR_TESTING
      ownerReferences:
        - apiVersion: v1
          blockOwnerDeletion: true
          controller: true
          kind: ConfigMap
          name: sg
          uid: NORMALIZED_FOR_TESTING
      resourceVersion: NORMALIZED_FOR_TESTING
      uid: NORMALIZED_FOR_TESTING
    spec:
      minReadySeconds: 10
      persistentVolumeClaimRetentionPolicy:
        whenDeleted: Retain
        whenScaled: Retain
      podManagementPolicy: OrderedReady
      replicas: 1
      revisionHistoryLimit: 10
      selector:
        matchLabels:
          app: grafana
      serviceName: grafana
      template:
        metadata:
          annotations:
            kubectl.kubernetes.io/default-container: grafana
          creationTimestamp: null
          labels:
            app: grafana
            deploy: sourcegraph
          name: grafana
        spec:
          containers:
            - image: index.docker.io/sourcegraph/grafana:5.3.9104
              imagePullPolicy: IfNotPresent
              name: grafana
              ports:
                - containerPort: 3370
                  name: http
                  protocol: TCP
              resources:
                limits:
                  cpu: "1"
                  memory: 512Mi
                requests:
                  cpu: 100m
                  memory: 512Mi
              securityContext:
                allowPrivilegeEscalation: false
                readOnlyRootFilesystem: true
                runAsGroup: 472
                runAsUser: 472
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: FallbackToLogsOnError
              volumeMounts:
                - mountPath: /var/lib/grafana
                  name: grafana-data
                - mountPath: /sg_config_grafana/provisioning/datasources
                  name: config
          dnsPolicy: ClusterFirst
          restartPolicy: Always
          schedulerName: default-scheduler
          securityContext:
            fsGroup: 472
            fsGroupChangePolicy: OnRootMismatch
            runAsGroup: 472
            runAsUser: 472
          serviceAccount: grafana
          serviceAccountName: grafana
          terminationGracePeriodSeconds: 30
          volumes:
            - configMap:
                defaultMode: 511
                name: grafana
              name: config
      updateStrategy:
        type: RollingUpdate
      volumeClaimTemplates:
        - apiVersion: v1
          kind: PersistentVolumeClaim
          metadata:
            creationTimestamp: null
            labels:
              deploy: sourcegraph
            name: grafana-data
            namespace: NORMALIZED_FOR_TESTING
          spec:
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 2Gi
            volumeMode: Filesystem
          status:
            phase: Pending
    status:
      availableReplicas: 0
      replicas: 0
  - apiVersion: v1
    data:
      datasources.yml: |
        apiVersion: 1

        datasources:
          - name: Prometheus
            type: prometheus
            access: proxy
            url: http://prometheus:30090
            isDefault: true
            editable: false
          - name: Jaeger
            type: Jaeger
            access: proxy
            url: http://jaeger-query:16686/-/debug/jaeger
      extra_rules.yml: ""
    immutable: false
    kind: ConfigMap
    metadata:
      annotations:
        appliance.sourcegraph.com/configHash: c7ada10d28d26c809f8b7e71aabb5a65420c3c2f306a364d3b9b966189d84a05
      creationTimestamp: "2024-04-19T00:00:00Z"
      labels:
        deploy: sourcegraph
      name: grafana
      namespace: NORMALIZED_FOR_TESTING
      ownerReferences:
        - apiVersion: v1
          blockOwnerDeletion: true
          controller: true
          kind: ConfigMap
          name: sg
          uid: NORMALIZED_FOR_TESTING
      resourceVersion: NORMALIZED_FOR_TESTING
      uid: NORMALIZED_FOR_TESTING
  - apiVersion: v1
    data:
      spec: |
        spec:
          requestedVersion: "5.3.9104"

          blobstore:
            disabled: true

          codeInsights:
            disabled: true

          codeIntel:
            disabled: true

          frontend:
            disabled: true

          gitServer:
            disabled: true

          indexedSearch:
            disabled: true

          openTelemetry:
            disabled: true

          pgsql:
            disabled: true

          postgresExporter:
            disabled: true

          preciseCodeIntel:
            disabled: true

          redisCache:
            containerConfig:
              redis-cache:
                image: redis-custom-image:default
              redis-exporter:
                image: redis-exporter-custom-image:default

          redisStore:
            disabled: true

          repoUpdater:
            disabled: true

          searcher:
            disabled: true

          symbols:
            disabled: true

          syntectServer:
            disabled: true

          worker:
            disabled: true

          prometheus:
            disabled: true
    kind: ConfigMap
    metadata:
      annotations:
        appliance.sourcegraph.com/currentVersion: 5.3.9104
        appliance.sourcegraph.com/managed: "true"
      creationTimestamp: "2024-04-19T00:00:00Z"
      name: sg
      namespace: NORMALIZED_FOR_TESTING
      resourceVersion: NORMALIZED_FOR_TESTING
      uid: NORMALIZED_FOR_TESTING
  - apiVersion: v1
    kind: PersistentVolumeClaim
    metadata:
      annotations:
        appliance.sourcegraph.com/configHash: 7fa2fa4ff84df20d92d920222aede2b1ac9aa4052123d7b4586cd1b7c5137530
      creationTimestamp: "2024-04-19T00:00:00Z"
      finalizers:
        - kubernetes.io/pvc-protection
      labels:
        deploy: sourcegraph
      name: redis-cache
      namespace: NORMALIZED_FOR_TESTING
      ownerReferences:
        - apiVersion: v1
          blockOwnerDeletion: true
          controller: true
          kind: ConfigMap
          name: sg
          uid: NORMALIZED_FOR_TESTING
      resourceVersion: NORMALIZED_FOR_TESTING
      uid: NORMALIZED_FOR_TESTING
    spec:
      accessModes:
        - ReadWriteOnce
      resources:
        requests:
          storage: 100Gi
      volumeMode: Filesystem
    status:
      phase: Pending
  - apiVersion: v1
    data:
      endpoint: cmVkaXMtY2FjaGU6NjM3OQ==
    kind: Secret
    metadata:
      annotations:
        appliance.sourcegraph.com/configHash: 7fa2fa4ff84df20d92d920222aede2b1ac9aa4052123d7b4586cd1b7c5137530
      creationTimestamp: "2024-04-19T00:00:00Z"
      labels:
        app.kubernetes.io/component: redis-cache
        app.kubernetes.io/name: sourcegraph
        app.kubernetes.io/version: 5.3.9104
        deploy: sourcegraph
      name: redis-cache
      namespace: NORMALIZED_FOR_TESTING
      ownerReferences:
        - apiVersion: v1
          blockOwnerDeletion: true
          controller: true
          kind: ConfigMap
          name: sg
          uid: NORMALIZED_FOR_TESTING
      resourceVersion: NORMALIZED_FOR_TESTING
      uid: NORMALIZED_FOR_TESTING
    type: Opaque
  - apiVersion: v1
    kind: ServiceAccount
    metadata:
      annotations:
        appliance.sourcegraph.com/configHash: c7ada10d28d26c809f8b7e71aabb5a65420c3c2f306a364d3b9b966189d84a05
      creationTimestamp: "2024-04-19T00:00:00Z"
      labels:
        deploy: sourcegraph
      name: grafana
      namespace: NORMALIZED_FOR_TESTING
      ownerReferences:
        - apiVersion: v1
          blockOwnerDeletion: true
          controller: true
          kind: ConfigMap
          name: sg
          uid: NORMALIZED_FOR_TESTING
      resourceVersion: NORMALIZED_FOR_TESTING
      uid: NORMALIZED_FOR_TESTING
  - apiVersion: v1
    kind: Service
    metadata:
      annotations:
        appliance.sourcegraph.com/configHash: c7ada10d28d26c809f8b7e71aabb5a65420c3c2f306a364d3b9b966189d84a05
      creationTimestamp: "2024-04-19T00:00:00Z"
      labels:
        app: grafana
        app.kubernetes.io/component: grafana
        deploy: sourcegraph
      name: grafana
      namespace: NORMALIZED_FOR_TESTING
      ownerReferences:
        - apiVersion: v1
          blockOwnerDeletion: true
          controller: true
          kind: ConfigMap
          name: sg
          uid: NORMALIZED_FOR_TESTING
      resourceVersion: NORMALIZED_FOR_TESTING
      uid: NORMALIZED_FOR_TESTING
    spec:
      clusterIP: NORMALIZED_FOR_TESTING
      clusterIPs:
        - NORMALIZED_FOR_TESTING
      internalTrafficPolicy: Cluster
      ipFamilies:
        - IPv4
      ipFamilyPolicy: SingleStack
      ports:
        - name: http
          port: 3181
          protocol: TCP
          targetPort: http
        - name: debug
          port: 6060
          protocol: TCP
          targetPort: debug
      selector:
        app: grafana
      sessionAffinity: None
      type: ClusterIP
    status:
      loadBalancer: {}
  - apiVersion: v1
    kind: Service
    metadata:
      annotations:
        appliance.sourcegraph.com/configHash: 7fa2fa4ff84df20d92d920222aede2b1ac9aa4052123d7b4586cd1b7c5137530
        prometheus.io/port: "9121"
        sourcegraph.prometheus/scrape: "true"
      creationTimestamp: "2024-04-19T00:00:00Z"
      labels:
        app: redis-cache
        app.kubernetes.io/component: redis-cache
        deploy: sourcegraph
      name: redis-cache
      namespace: NORMALIZED_FOR_TESTING
      ownerReferences:
        - apiVersion: v1
          blockOwnerDeletion: true
          controller: true
          kind: ConfigMap
          name: sg
          uid: NORMALIZED_FOR_TESTING
      resourceVersion: NORMALIZED_FOR_TESTING
      uid: NORMALIZED_FOR_TESTING
    spec:
      clusterIP: NORMALIZED_FOR_TESTING
      clusterIPs:
        - NORMALIZED_FOR_TESTING
      internalTrafficPolicy: Cluster
      ipFamilies:
        - IPv4
      ipFamilyPolicy: SingleStack
      ports:
        - name: redis
          port: 6379
          protocol: TCP
          targetPort: redis
      selector:
        app: redis-cache
      sessionAffinity: None
      type: ClusterIP
    status:
      loadBalancer: {}
