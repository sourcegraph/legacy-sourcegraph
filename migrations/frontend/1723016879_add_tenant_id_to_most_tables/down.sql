-- Temporary function to deduplicate the logic required for each table:
CREATE OR REPLACE FUNCTION migrate_add_tenant_id_frontend(table_name text)
RETURNS void AS $$
BEGIN
    EXECUTE format('ALTER TABLE %I DROP COLUMN IF EXISTS tenant_id;', table_name);
END;
$$ LANGUAGE plpgsql;

SELECT migrate_add_tenant_id_frontend('access_requests');
SELECT migrate_add_tenant_id_frontend('access_tokens');
SELECT migrate_add_tenant_id_frontend('aggregated_user_statistics');
SELECT migrate_add_tenant_id_frontend('assigned_owners');
SELECT migrate_add_tenant_id_frontend('assigned_teams');
SELECT migrate_add_tenant_id_frontend('batch_changes');
SELECT migrate_add_tenant_id_frontend('batch_changes_site_credentials');
SELECT migrate_add_tenant_id_frontend('batch_spec_execution_cache_entries');
SELECT migrate_add_tenant_id_frontend('batch_spec_resolution_jobs');
SELECT migrate_add_tenant_id_frontend('batch_spec_workspace_execution_jobs');
SELECT migrate_add_tenant_id_frontend('batch_spec_workspace_execution_last_dequeues');
SELECT migrate_add_tenant_id_frontend('batch_spec_workspace_files');
SELECT migrate_add_tenant_id_frontend('batch_spec_workspaces');
SELECT migrate_add_tenant_id_frontend('batch_specs');
SELECT migrate_add_tenant_id_frontend('cached_available_indexers');
SELECT migrate_add_tenant_id_frontend('changeset_events');
SELECT migrate_add_tenant_id_frontend('changeset_jobs');
SELECT migrate_add_tenant_id_frontend('changeset_specs');
SELECT migrate_add_tenant_id_frontend('changesets');
SELECT migrate_add_tenant_id_frontend('cm_action_jobs');
SELECT migrate_add_tenant_id_frontend('cm_emails');
SELECT migrate_add_tenant_id_frontend('cm_last_searched');
SELECT migrate_add_tenant_id_frontend('cm_monitors');
SELECT migrate_add_tenant_id_frontend('cm_queries');
SELECT migrate_add_tenant_id_frontend('cm_recipients');
SELECT migrate_add_tenant_id_frontend('cm_slack_webhooks');
SELECT migrate_add_tenant_id_frontend('cm_trigger_jobs');
SELECT migrate_add_tenant_id_frontend('cm_webhooks');
SELECT migrate_add_tenant_id_frontend('code_hosts');
SELECT migrate_add_tenant_id_frontend('codeintel_autoindex_queue');
SELECT migrate_add_tenant_id_frontend('codeintel_autoindexing_exceptions');
SELECT migrate_add_tenant_id_frontend('codeintel_commit_dates');
SELECT migrate_add_tenant_id_frontend('codeintel_inference_scripts');
SELECT migrate_add_tenant_id_frontend('codeintel_initial_path_ranks');
SELECT migrate_add_tenant_id_frontend('codeintel_initial_path_ranks_processed');
SELECT migrate_add_tenant_id_frontend('codeintel_langugage_support_requests');
SELECT migrate_add_tenant_id_frontend('codeintel_path_ranks');
SELECT migrate_add_tenant_id_frontend('codeintel_ranking_definitions');
SELECT migrate_add_tenant_id_frontend('codeintel_ranking_exports');
SELECT migrate_add_tenant_id_frontend('codeintel_ranking_graph_keys');
SELECT migrate_add_tenant_id_frontend('codeintel_ranking_path_counts_inputs');
SELECT migrate_add_tenant_id_frontend('codeintel_ranking_progress');
SELECT migrate_add_tenant_id_frontend('codeintel_ranking_references');
SELECT migrate_add_tenant_id_frontend('codeintel_ranking_references_processed');
SELECT migrate_add_tenant_id_frontend('codeowners');
SELECT migrate_add_tenant_id_frontend('codeowners_individual_stats');
SELECT migrate_add_tenant_id_frontend('codeowners_owners');
SELECT migrate_add_tenant_id_frontend('commit_authors');
SELECT migrate_add_tenant_id_frontend('configuration_policies_audit_logs');
SELECT migrate_add_tenant_id_frontend('context_detection_embedding_jobs');
SELECT migrate_add_tenant_id_frontend('discussion_comments');
SELECT migrate_add_tenant_id_frontend('discussion_mail_reply_tokens');
SELECT migrate_add_tenant_id_frontend('discussion_threads');
SELECT migrate_add_tenant_id_frontend('discussion_threads_target_repo');
SELECT migrate_add_tenant_id_frontend('event_logs');
SELECT migrate_add_tenant_id_frontend('event_logs_export_allowlist');
SELECT migrate_add_tenant_id_frontend('event_logs_scrape_state');
SELECT migrate_add_tenant_id_frontend('event_logs_scrape_state_own');
SELECT migrate_add_tenant_id_frontend('executor_heartbeats');
SELECT migrate_add_tenant_id_frontend('executor_job_tokens');
SELECT migrate_add_tenant_id_frontend('executor_secret_access_logs');
SELECT migrate_add_tenant_id_frontend('executor_secrets');
SELECT migrate_add_tenant_id_frontend('exhaustive_search_jobs');
SELECT migrate_add_tenant_id_frontend('exhaustive_search_repo_jobs');
SELECT migrate_add_tenant_id_frontend('exhaustive_search_repo_revision_jobs');
SELECT migrate_add_tenant_id_frontend('explicit_permissions_bitbucket_projects_jobs');
SELECT migrate_add_tenant_id_frontend('external_service_repos');
SELECT migrate_add_tenant_id_frontend('external_service_sync_jobs');
SELECT migrate_add_tenant_id_frontend('external_services');
SELECT migrate_add_tenant_id_frontend('feature_flag_overrides');
SELECT migrate_add_tenant_id_frontend('feature_flags');
SELECT migrate_add_tenant_id_frontend('github_app_installs');
SELECT migrate_add_tenant_id_frontend('github_apps');
SELECT migrate_add_tenant_id_frontend('gitserver_relocator_jobs');
SELECT migrate_add_tenant_id_frontend('gitserver_repos');
SELECT migrate_add_tenant_id_frontend('gitserver_repos_statistics');
SELECT migrate_add_tenant_id_frontend('gitserver_repos_sync_output');
SELECT migrate_add_tenant_id_frontend('global_state');
SELECT migrate_add_tenant_id_frontend('insights_query_runner_jobs');
SELECT migrate_add_tenant_id_frontend('insights_query_runner_jobs_dependencies');
SELECT migrate_add_tenant_id_frontend('insights_settings_migration_jobs');
SELECT migrate_add_tenant_id_frontend('lsif_configuration_policies');
SELECT migrate_add_tenant_id_frontend('lsif_configuration_policies_repository_pattern_lookup');
SELECT migrate_add_tenant_id_frontend('lsif_dependency_indexing_jobs');
SELECT migrate_add_tenant_id_frontend('lsif_dependency_repos');
SELECT migrate_add_tenant_id_frontend('lsif_dependency_syncing_jobs');
SELECT migrate_add_tenant_id_frontend('lsif_dirty_repositories');
SELECT migrate_add_tenant_id_frontend('lsif_index_configuration');
SELECT migrate_add_tenant_id_frontend('lsif_indexes');
SELECT migrate_add_tenant_id_frontend('lsif_last_index_scan');
SELECT migrate_add_tenant_id_frontend('lsif_last_retention_scan');
SELECT migrate_add_tenant_id_frontend('lsif_nearest_uploads');
SELECT migrate_add_tenant_id_frontend('lsif_nearest_uploads_links');
SELECT migrate_add_tenant_id_frontend('lsif_packages');
SELECT migrate_add_tenant_id_frontend('lsif_references');
SELECT migrate_add_tenant_id_frontend('lsif_retention_configuration');
SELECT migrate_add_tenant_id_frontend('lsif_uploads');
SELECT migrate_add_tenant_id_frontend('lsif_uploads_audit_logs');
SELECT migrate_add_tenant_id_frontend('lsif_uploads_reference_counts');
SELECT migrate_add_tenant_id_frontend('lsif_uploads_visible_at_tip');
SELECT migrate_add_tenant_id_frontend('lsif_uploads_vulnerability_scan');
SELECT migrate_add_tenant_id_frontend('names');
SELECT migrate_add_tenant_id_frontend('namespace_permissions');
SELECT migrate_add_tenant_id_frontend('notebook_stars');
SELECT migrate_add_tenant_id_frontend('notebooks');
SELECT migrate_add_tenant_id_frontend('org_invitations');
SELECT migrate_add_tenant_id_frontend('org_members');
SELECT migrate_add_tenant_id_frontend('org_stats');
SELECT migrate_add_tenant_id_frontend('orgs');
SELECT migrate_add_tenant_id_frontend('orgs_open_beta_stats');
SELECT migrate_add_tenant_id_frontend('out_of_band_migrations');
SELECT migrate_add_tenant_id_frontend('out_of_band_migrations_errors');
SELECT migrate_add_tenant_id_frontend('outbound_webhook_event_types');
SELECT migrate_add_tenant_id_frontend('outbound_webhook_jobs');
SELECT migrate_add_tenant_id_frontend('outbound_webhook_logs');
SELECT migrate_add_tenant_id_frontend('outbound_webhooks');
SELECT migrate_add_tenant_id_frontend('own_aggregate_recent_contribution');
SELECT migrate_add_tenant_id_frontend('own_aggregate_recent_view');
SELECT migrate_add_tenant_id_frontend('own_background_jobs');
SELECT migrate_add_tenant_id_frontend('own_signal_configurations');
SELECT migrate_add_tenant_id_frontend('own_signal_recent_contribution');
SELECT migrate_add_tenant_id_frontend('ownership_path_stats');
SELECT migrate_add_tenant_id_frontend('package_repo_filters');
SELECT migrate_add_tenant_id_frontend('package_repo_versions');
SELECT migrate_add_tenant_id_frontend('permission_sync_jobs');
SELECT migrate_add_tenant_id_frontend('permissions');
SELECT migrate_add_tenant_id_frontend('phabricator_repos');
SELECT migrate_add_tenant_id_frontend('product_licenses');
SELECT migrate_add_tenant_id_frontend('product_subscriptions');
SELECT migrate_add_tenant_id_frontend('prompts');
SELECT migrate_add_tenant_id_frontend('query_runner_state');
SELECT migrate_add_tenant_id_frontend('redis_key_value');
SELECT migrate_add_tenant_id_frontend('registry_extension_releases');
SELECT migrate_add_tenant_id_frontend('registry_extensions');
SELECT migrate_add_tenant_id_frontend('repo');
SELECT migrate_add_tenant_id_frontend('repo_commits_changelists');
SELECT migrate_add_tenant_id_frontend('repo_embedding_job_stats');
SELECT migrate_add_tenant_id_frontend('repo_embedding_jobs');
SELECT migrate_add_tenant_id_frontend('repo_kvps');
SELECT migrate_add_tenant_id_frontend('repo_paths');
SELECT migrate_add_tenant_id_frontend('repo_pending_permissions');
SELECT migrate_add_tenant_id_frontend('repo_permissions');
SELECT migrate_add_tenant_id_frontend('repo_statistics');
SELECT migrate_add_tenant_id_frontend('role_permissions');
SELECT migrate_add_tenant_id_frontend('roles');
SELECT migrate_add_tenant_id_frontend('saved_searches');
SELECT migrate_add_tenant_id_frontend('search_context_default');
SELECT migrate_add_tenant_id_frontend('search_context_repos');
SELECT migrate_add_tenant_id_frontend('search_context_stars');
SELECT migrate_add_tenant_id_frontend('search_contexts');
SELECT migrate_add_tenant_id_frontend('security_event_logs');
SELECT migrate_add_tenant_id_frontend('settings');
SELECT migrate_add_tenant_id_frontend('sub_repo_permissions');
SELECT migrate_add_tenant_id_frontend('survey_responses');
SELECT migrate_add_tenant_id_frontend('syntactic_scip_indexing_jobs');
SELECT migrate_add_tenant_id_frontend('syntactic_scip_last_index_scan');
SELECT migrate_add_tenant_id_frontend('team_members');
SELECT migrate_add_tenant_id_frontend('teams');
SELECT migrate_add_tenant_id_frontend('telemetry_events_export_queue');
SELECT migrate_add_tenant_id_frontend('temporary_settings');
SELECT migrate_add_tenant_id_frontend('user_credentials');
SELECT migrate_add_tenant_id_frontend('user_emails');
SELECT migrate_add_tenant_id_frontend('user_external_accounts');
SELECT migrate_add_tenant_id_frontend('user_onboarding_tour');
SELECT migrate_add_tenant_id_frontend('user_pending_permissions');
SELECT migrate_add_tenant_id_frontend('user_permissions');
SELECT migrate_add_tenant_id_frontend('user_public_repos');
SELECT migrate_add_tenant_id_frontend('user_repo_permissions');
SELECT migrate_add_tenant_id_frontend('user_roles');
SELECT migrate_add_tenant_id_frontend('users');
SELECT migrate_add_tenant_id_frontend('vulnerabilities');
SELECT migrate_add_tenant_id_frontend('vulnerability_affected_packages');
SELECT migrate_add_tenant_id_frontend('vulnerability_affected_symbols');
SELECT migrate_add_tenant_id_frontend('vulnerability_matches');
SELECT migrate_add_tenant_id_frontend('webhook_logs');
SELECT migrate_add_tenant_id_frontend('webhooks');
SELECT migrate_add_tenant_id_frontend('zoekt_repos');

DROP FUNCTION migrate_add_tenant_id_frontend(text);
